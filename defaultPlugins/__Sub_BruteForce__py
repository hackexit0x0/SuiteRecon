import os
import subprocess

def dnsrecon(domain, output_file):
    """
    Uses dnsrecon to enumerate subdomains.

    Parameters:
        domain (str): The target domain for enumeration.
        output_file (str): The file path to save the results.
    """
    wordlist = "wordlist/subdomains/subdomains-1m.txt"
    print("[+] Running dnsrecon...")
    try:
        command = [
            "dnsrecon",
            "-d", domain,
            "-D", wordlist,
            "-t", "brt",
            "-v"
        ]
        with open(output_file, "w") as outfile:
            subprocess.run(command, check=True, stdout=outfile, stderr=subprocess.STDOUT)
        print(f"[+] Dnsrecon results saved at: {output_file}")
    except FileNotFoundError:
        print("[!] dnsrecon not installed. Please install it and try again.")
    except subprocess.CalledProcessError as e:
        print(f"[!] Error running dnsrecon: {e}")

def main(domain):
    """
    Coordinates the subdomain enumeration process.

    Parameters:
        domain (str): The target domain for enumeration.
    """
    if not domain:
        print("[!] No domain provided. Exiting.")
        return

    print(f"[+] Starting Subdomain enumeration for: {domain}")

    # Create directory structure for results
    path = f"results/{domain}/fetchSubdomains/Subdomain_BruteForce/"
    os.makedirs(path, exist_ok=True)

    # Run dnsrecon
    output_file = f"{path}dnsrecon.txt"
    dnsrecon(domain, output_file)

if __name__ == "__main__":
    domain_input = input("Enter the domain to enumerate subdomains: ").strip()
    main(domain_input)
